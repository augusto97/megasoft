# üöÄ Mega Soft Gateway para WooCommerce - PRODUCCI√ìN

[![Versi√≥n](https://img.shields.io/badge/version-3.0.0-blue.svg)](https://github.com/)
[![WooCommerce](https://img.shields.io/badge/WooCommerce-6.0%2B-purple.svg)](https://woocommerce.com/)
[![WordPress](https://img.shields.io/badge/WordPress-5.8%2B-blue.svg)](https://wordpress.org/)
[![PHP](https://img.shields.io/badge/PHP-7.4%2B-777BB4.svg)](https://php.net/)

Pasarela de pago profesional para WooCommerce que integra completamente con Mega Soft Computaci√≥n C.A. (Venezuela). Desarrollado para **uso en producci√≥n** con todas las caracter√≠sticas empresariales necesarias.

## ‚ú® Caracter√≠sticas Principales

### üîÑ **Integraci√≥n Completa**
- ‚úÖ **Modalidad Universal** completa seg√∫n documentaci√≥n v4.24
- ‚úÖ Soporte para **TDC Nacional/Internacional** y **Pago M√≥vil**
- ‚úÖ **Pre-registro autom√°tico** con validaci√≥n de seguridad
- ‚úÖ **Consulta de estado** en tiempo real
- ‚úÖ **Webhooks autom√°ticos** para actualizaciones instant√°neas
- ‚úÖ **Reembolsos** directos desde WooCommerce

### üìã **Validaci√≥n de Documentos**
- ‚úÖ **Tipos de documento completos**: V, E, J, G, P, C (nuevo)
- ‚úÖ **Validaci√≥n autom√°tica** por tipo de documento
- ‚úÖ **Guardado opcional** para clientes registrados
- ‚úÖ **Cumplimiento regulatorio** venezolano

### üí≥ **Opciones de Pago**
- ‚úÖ **Cuotas configurables** (3, 6, 12, 18, 24 meses)
- ‚úÖ **Monto m√≠nimo** configurable para cuotas
- ‚úÖ **C√°lculo autom√°tico** de montos por cuota
- ‚úÖ **Preautorizaci√≥n y captura** manual opcional

### üõ°Ô∏è **Seguridad Avanzada**
- ‚úÖ **Validaci√≥n de n√∫meros de control** en retornos
- ‚úÖ **Autenticaci√≥n Basic Auth** con credenciales encriptadas
- ‚úÖ **Sanitizaci√≥n completa** de datos de entrada
- ‚úÖ **Logs de auditor√≠a** detallados
- ‚úÖ **Verificaci√≥n SSL** obligatoria en producci√≥n

### üìä **Dashboard Administrativo**
- ‚úÖ **Panel de control** con estad√≠sticas en tiempo real
- ‚úÖ **Gesti√≥n de transacciones** con filtros avanzados
- ‚úÖ **Sistema de logs** con m√∫ltiples niveles
- ‚úÖ **Reportes gr√°ficos** con Chart.js
- ‚úÖ **Herramientas de mantenimiento** y diagn√≥stico

### üîÑ **Automatizaci√≥n**
- ‚úÖ **Sincronizaci√≥n autom√°tica** cada hora
- ‚úÖ **Reintentos de webhooks** fallidos
- ‚úÖ **Limpieza autom√°tica** de datos antiguos
- ‚úÖ **Notificaciones por email** para errores cr√≠ticos
- ‚úÖ **Tareas cron** programadas

## üì¶ Estructura del Plugin

```
woocommerce-megasoft-gateway/
‚îú‚îÄ‚îÄ woocommerce-megasoft-gateway.php     # Archivo principal
‚îú‚îÄ‚îÄ includes/                            # Clases del sistema
‚îÇ   ‚îú‚îÄ‚îÄ class-megasoft-logger.php       # Sistema de logs
‚îÇ   ‚îú‚îÄ‚îÄ class-megasoft-api.php          # Comunicaci√≥n con API
‚îÇ   ‚îú‚îÄ‚îÄ class-megasoft-webhook.php      # Manejo de webhooks
‚îÇ   ‚îî‚îÄ‚îÄ class-megasoft-admin.php        # Panel administrativo
‚îú‚îÄ‚îÄ assets/                              # Recursos est√°ticos
‚îÇ   ‚îú‚îÄ‚îÄ css/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ admin.css                   # Estilos del admin
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ checkout.css                # Estilos del checkout
‚îÇ   ‚îú‚îÄ‚îÄ js/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ admin.js                    # JavaScript del admin
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ checkout.js                 # JavaScript del checkout
‚îÇ   ‚îî‚îÄ‚îÄ images/
‚îÇ       ‚îî‚îÄ‚îÄ megasoft-icon.png           # Icono del plugin
‚îú‚îÄ‚îÄ languages/                           # Traducciones
‚îî‚îÄ‚îÄ README.md                           # Esta documentaci√≥n
```

## ‚ö° Instalaci√≥n

### 1. **Requisitos del Sistema**
- WordPress 5.8 o superior
- WooCommerce 6.0 o superior
- PHP 7.4 o superior
- MySQL 5.7 o superior
- SSL (HTTPS) para producci√≥n
- cURL habilitado
- OpenSSL habilitado

### 2. **Instalaci√≥n del Plugin**
```bash
# Opci√≥n 1: Subir via WordPress Admin
1. Descargar el archivo ZIP del plugin
2. Ir a Plugins > A√±adir nuevo > Subir plugin
3. Seleccionar archivo y activar

# Opci√≥n 2: Instalaci√≥n manual
1. Subir carpeta al directorio /wp-content/plugins/
2. Activar desde el panel de WordPress
```

### 3. **Configuraci√≥n Inicial**
```bash
# Despu√©s de activar el plugin:
1. Ir a WooCommerce > Ajustes > Pagos
2. Buscar "Mega Soft Gateway" y hacer clic en "Configurar"
3. Completar las credenciales proporcionadas por Mega Soft
4. Activar el gateway
5. Realizar pruebas de conexi√≥n
```

## üîß Configuraci√≥n

### **Credenciales API**
```php
// Ambiente de Prueba
C√≥digo de Afiliaci√≥n: 20250508
Usuario API: multimuniv  
Contrase√±a API: Caracas123.1
URL Base: https://paytest.megasoft.com.ve/action/

// Ambiente de Producci√≥n
C√≥digo de Afiliaci√≥n: [Proporcionado por Mega Soft]
Usuario API: [Proporcionado por Mega Soft]
Contrase√±a API: [Proporcionado por Mega Soft]
URL Base: https://pay.megasoft.com.ve/action/
```

### **URLs Requeridas por Mega Soft**
```
URL de Retorno:
https://tu-sitio.com/wc-api/WC_Gateway_MegaSoft_Universal?control=@control@&factura=@facturatrx@

URL de Webhook (Opcional):
https://tu-sitio.com/wc-api/megasoft_webhook
```

### **Configuraciones Avanzadas**

#### **Documentos de Identidad**
- ‚úÖ **Requerir documento**: Obligatorio para cumplir regulaciones
- ‚úÖ **Guardar documentos**: Permite reutilizaci√≥n para clientes registrados
- ‚úÖ **Tipos soportados**: V, E, J, G, P, C

#### **Sistema de Cuotas**
- ‚úÖ **Cuotas m√°ximas**: 3, 6, 12, 18, 24 meses
- ‚úÖ **Monto m√≠nimo**: Configurable por el comercio
- ‚úÖ **C√°lculo autom√°tico**: Muestra monto por cuota en tiempo real

#### **Logs y Depuraci√≥n**
- ‚úÖ **Niveles de log**: Debug, Info, Warning, Error
- ‚úÖ **Retenci√≥n**: 30 d√≠as por defecto
- ‚úÖ **Exportaci√≥n**: CSV con filtros de fecha
- ‚úÖ **Limpieza autom√°tica**: Configurable

## üéØ Uso del Plugin

### **Para Administradores**

#### **Dashboard Principal**
```
Mega Soft > Dashboard
- Estado del gateway en tiempo real
- Estad√≠sticas de transacciones (hoy, semana, mes)
- Acciones r√°pidas (test, sync, limpieza)
- Transacciones recientes
```

#### **Gesti√≥n de Transacciones**
```
Mega Soft > Transacciones
- Lista filtrable de todas las transacciones
- Estados: Pendiente, Aprobada, Fallida
- B√∫squeda por orden, control, cliente
- Sincronizaci√≥n manual individual
- Exportaci√≥n de datos
```

#### **Sistema de Logs**
```
Mega Soft > Logs
- Logs detallados por nivel (Error, Warning, Info, Debug)
- Filtros por fecha y tipo
- B√∫squeda de logs espec√≠ficos
- Exportaci√≥n y limpieza autom√°tica
```

#### **Reportes Gr√°ficos**
```
Mega Soft > Reportes
- Gr√°ficos de transacciones por d√≠a
- Distribuci√≥n por m√©todos de pago
- Tasas de aprobaci√≥n/rechazo
- Top 10 transacciones
- Per√≠odos configurables
```

#### **Herramientas del Sistema**
```
Mega Soft > Herramientas
- Prueba de conexi√≥n con API
- Sincronizaci√≥n manual masiva
- Limpieza de datos antiguos
- Exportar/importar configuraci√≥n
- Informaci√≥n del sistema
- Generador de datos de prueba
```

### **Para Clientes (Checkout)**

#### **Flujo de Pago**
1. **Selecci√≥n de m√©todo**: Cliente elige "Tarjeta de Cr√©dito/D√©bito y Pago M√≥vil"
2. **Datos de documento**: Ingresa tipo y n√∫mero de documento
3. **Opciones de cuotas**: Selecciona n√∫mero de cuotas si aplica
4. **Confirmaci√≥n**: Revisa datos y confirma
5. **Redirecci√≥n**: Va a la pasarela de Mega Soft
6. **Pago**: Completa el pago en el sitio seguro
7. **Retorno**: Regresa autom√°ticamente a la tienda
8. **Confirmaci√≥n**: Ve el comprobante y detalles

## üîê Seguridad y Cumplimiento

### **Medidas de Seguridad**
- ‚úÖ **Validaci√≥n de entrada**: Todos los datos son sanitizados
- ‚úÖ **N√∫meros de control**: Verificaci√≥n cruzada en retornos
- ‚úÖ **Logs de auditor√≠a**: Registro completo de actividades
- ‚úÖ **Encriptaci√≥n**: Credenciales y datos sensibles protegidos
- ‚úÖ **SSL obligatorio**: Verificaci√≥n autom√°tica en producci√≥n

### **Cumplimiento Regulatorio**
- ‚úÖ **Documentos de identidad**: Seg√∫n regulaciones venezolanas
- ‚úÖ **Comprobantes**: Vouchers imprimibles obligatorios
- ‚úÖ **Trazabilidad**: Logs completos de todas las transacciones
- ‚úÖ **Retenci√≥n de datos**: Configurable seg√∫n normativas

## üß™ Pruebas y Certificaci√≥n

### **Script de Pruebas Mega Soft**
El plugin incluye datos de prueba seg√∫n el script oficial:

| ID | Transacci√≥n | Tipo | Datos | Monto | Resultado Esperado |
|----|-------------|------|-------|-------|-------------------|
| 1 | Compra Cr√©dito | Cr√©dito | TDC 5420070695259279 | 0.01 | Aprobada |
| 2 | Compra Cr√©dito | Cr√©dito | TDC 5420070695259279 | 10100.51 | Negada (Fondos) |
| 3 | Compra Cr√©dito | Cr√©dito | TDC 5420070695259279 | 33500.01 | Time Out |
| 4 | Pago C2P | C2P | Tel√©fono 0412-1234571 | 3330 | Variable |
| 5 | Pago C2P | C2P | Tel√©fono 0412-1234572 | 33500.01 | Variable |
| 6 | Verificaci√≥n P2C | Verificacion | Tel√©fono 0412-1234569 | 1000 | Aprobada |
| 7 | Verificaci√≥n P2C | Verificacion | Tel√©fono 0412-1234571 | 25300.02 | Negada |
| 8 | Verificaci√≥n P2C | Verificacion | Tel√©fono 0412-1234572 | 25300.03 | Negada |
| 9 | P2C Inactivo | Verificacion | Error simulado | N/A | Error de plataforma |

### **Evidencias de Certificaci√≥n**
Para completar la certificaci√≥n con Mega Soft:

1. **Ejecutar todas las pruebas** del script
2. **Capturar pantallas** de cada voucher generado
3. **Documentar en PDF** cada evidencia con su ID
4. **Enviar a Mega Soft** para aprobaci√≥n final

## üîß Mantenimiento

### **Tareas Autom√°ticas**
```php
// Configuradas autom√°ticamente:
- Sincronizaci√≥n de transacciones: Cada hora
- Limpieza de logs antiguos: Diaria  
- Procesamiento de webhooks fallidos: Cada 5 minutos
- Verificaci√≥n de estado del gateway: Cada hora
```

### **Mantenimiento Manual**
```bash
# Via Dashboard:
1. Mega Soft > Herramientas > Limpieza de Datos
2. Mega Soft > Logs > Limpiar Antiguos  
3. Mega Soft > Herramientas > Prueba de Conexi√≥n
4. Mega Soft > Transacciones > Sincronizar
```

### **Monitoreo**
```php
// Alertas autom√°ticas por email:
- Errores cr√≠ticos de conexi√≥n
- Transacciones pendientes > 24h
- Fallos de webhook > 5 intentos
- Problemas de configuraci√≥n
```

## üìû Soporte y Soluci√≥n de Problemas

### **Problemas Comunes**

#### **Error de Conexi√≥n**
```
S√≠ntoma: "Error de conexi√≥n con la pasarela"
Soluci√≥n:
1. Verificar credenciales en configuraci√≥n
2. Probar conexi√≥n desde Herramientas
3. Verificar que las IPs est√©n autorizadas
4. Revisar logs para detalles espec√≠ficos
```

#### **Transacciones Pendientes**
```
S√≠ntoma: Transacciones que no se actualizan
Soluci√≥n:
1. Usar sincronizaci√≥n manual desde Transacciones
2. Verificar webhooks en Logs
3. Revisar n√∫mero de control en orden
4. Contactar a Mega Soft si persiste
```

#### **Vouchers No Aparecen**
```
S√≠ntoma: Comprobantes vac√≠os o incompletos
Soluci√≥n:
1. Verificar respuesta XML en logs
2. Revisar formato de voucher en c√≥digo
3. Probar con transacci√≥n de prueba
4. Verificar configuraci√≥n de impresi√≥n
```

### **Informaci√≥n de Debug**
```php
// Activar logs de depuraci√≥n:
1. WooCommerce > Ajustes > Pagos > Mega Soft > Configurar
2. Activar "Modo Debug" 
3. Seleccionar nivel "Debug"
4. Reproducir problema
5. Revisar Mega Soft > Logs
```

### **Contacto de Soporte**
- **Email**: merchant@megasoft.com.ve
- **Tel√©fono**: +58 (212) XXX-XXXX
- **Documentaci√≥n**: [Manual t√©cnico v4.24]
- **Horario**: Lunes a Viernes, 8:00 AM - 5:00 PM (VET)

## üöÄ Actualizaciones

### **Versi√≥n 3.0.0** (Actual)
- ‚úÖ Dashboard administrativo completo
- ‚úÖ Sistema de webhooks autom√°tico  
- ‚úÖ Reportes gr√°ficos avanzados
- ‚úÖ Herramientas de mantenimiento
- ‚úÖ Validaci√≥n completa de documentos
- ‚úÖ Soporte para cuotas autom√°tico
- ‚úÖ Logs estructurados en base de datos
- ‚úÖ Exportaci√≥n e importaci√≥n de configuraci√≥n

### **Pr√≥ximas Caracter√≠sticas**
- üîÑ Integraci√≥n con otros bancos venezolanos
- üîÑ API REST para integraciones externas  
- üîÑ Panel de estad√≠sticas para clientes
- üîÑ Notificaciones push en tiempo real
- üîÑ Integraci√≥n con sistemas contables

## üìÑ Licencia

Este plugin est√° licenciado bajo GPL v2 o posterior. Ver archivo `LICENSE` para m√°s detalles.

---

**Desarrollado por:** [Tu Nombre/Empresa]  
**Versi√≥n:** 3.0.0  
**√öltima actualizaci√≥n:** Agosto 2025  
**Compatibilidad:** WordPress 5.8+ | WooCommerce 6.0+ | PHP 7.4+  

---

## üéØ ¬øListo para Producci√≥n?

Este plugin ha sido dise√±ado espec√≠ficamente para **uso en producci√≥n** con todas las caracter√≠sticas empresariales que necesita una tienda online profesional:

- ‚úÖ **Completamente funcional** con Mega Soft API v4.24
- ‚úÖ **Interfaz administrativa profesional** 
- ‚úÖ **Sistema de monitoreo** y alertas autom√°ticas
- ‚úÖ **Logs detallados** para auditor√≠a y debugging
- ‚úÖ **Webhooks autom√°ticos** para sincronizaci√≥n instant√°nea
- ‚úÖ **Herramientas de mantenimiento** integradas
- ‚úÖ **Certificaci√≥n completa** seg√∫n script de Mega Soft
- ‚úÖ **Cumplimiento regulatorio** venezolano

**¬°Tu tienda online est√° lista para procesar pagos de forma segura y profesional! üöÄ**